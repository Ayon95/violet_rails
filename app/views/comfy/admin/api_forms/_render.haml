%link{:crossorigin => "anonymous", :href => "https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.0.0/jsoneditor.css", :integrity => "sha512-Mfp9P5Ln+lF/PmixCJBHUNHXoBKJwKY2i7oZ29iu/mnN47puo0TH/ORb3vgrdkyuBkLaDytv80480FNZxllpyQ==", :referrerpolicy => "no-referrer", :rel => "stylesheet"}/
%script{:crossorigin => "anonymous", :integrity => "sha512-xEv8uIENS4DGY7Ml/Cv6+sbcPXiRAguIgU8Sv0FCUUdrNC7aRhWbOglm7lnzhnA3spqCr8DnTMTMNFW4jhM8gA==", :referrerpolicy => "no-referrer", :src => "https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.0.0/jsoneditor.js"}
- properties = JSON.parse(@api_namespace.properties).symbolize_keys
- form_properties = @api_form.properties.symbolize_keys
= form_for :data, url: api_create_resource_path(api_namespace: @api_namespace.slug, version: @api_namespace.version), method: :post, html: {class: 'violet-cta-form', 'data-type': 'json', multipart: true, id: 'api_form'}, remote: true do |f|
  .form-group
    - properties.each do |key, value|
      .form-group
        = f.label key, form_properties[key]["label"]
        = map_form_field(f, key, value, form_properties)
    - @api_namespace.non_primitive_properties.each_with_index do |property, index|
      = fields_for "data[non_primitive_properties_attributes][#{index}]", property do |ff|
        .form-group
          = label_tag property.label
          = map_non_primitive_data_type(ff, property.field_type)
        = ff.hidden_field :field_type
        = ff.hidden_field :label
  = recaptcha_tags callback: 'ctaSuccessHandler' if @api_form.show_recaptcha
  = f.submit @api_form.submit_button_label, disabled: @api_form.show_recaptcha, class: 'my-2 btn btn-primary'

:javascript
  $(document).ready( function() {
    $(".array_select").select2({
      multiple: true,
      required: false
    })
    $('.array_select').each(function() {
      $(this).val(JSON.parse($(this).attr('default_value'))).change();
    })
  });
